@model WebUI.Models.IndexViewModel
@{
    ViewBag.Title = "Home Page";
}

<div class="row">
    @foreach (var item in Model.Rooms)
    {
        <h2>@item.RoomName (@item.RoomId)</h2>
        <div class="progress">
            <div id="room@(item.RoomId)" class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width:100%">
                Waiting for seating info...
            </div>
        </div>
    }
</div>

@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    @Scripts.Render("~/bundles/jquerysignalr")
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the update the page. -->
    <script>

        $(function () {
            // Declare a proxy to reference the hub.
            var hub = $.connection.seatAvailabilityHub;
            // Create a function that the hub can call to broadcast messages.
            hub.client.updateSeatAvailability = function (roomId, seatAvailability) {

                $('#room' + roomId)
                    .removeClass('progress-bar-info')
                    .toggleClass('progress-bar-success', seatAvailability >= 50)
                    .toggleClass('progress-bar-warning', seatAvailability >= 25 && seatAvailability < 50)
                    .toggleClass('progress-bar-danger', seatAvailability < 25)
                    .width(seatAvailability + '%')
                    .attr('valuenow', seatAvailability)
                    .text(seatAvailability + ' available seat(s)');
            };
            // Start the connection.
            $.connection.hub.start();
        });

    </script>
}